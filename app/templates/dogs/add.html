{% extends "layout.html" %}

{% block title %}Add New Dog | Burdell's Devoted Dogs{% endblock %}

{% block extra_css %}
<style>
  .form-label {
    font-weight: 500;
    margin-bottom: 8px;
  }
  
  .form-control, .form-select {
    border-radius: 4px;
    border: 1px solid #D4AF37;
    padding: 10px 12px;
    margin-bottom: 20px;
    transition: all 0.3s ease;
  }
  
  .form-control:focus, .form-select:focus {
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
    border-color: #8B4513;
  }
  
  .required-field {
    color: #FF6B6B;
    font-weight: bold;
  }
  
  .card {
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    margin-bottom: 30px;
  }
  
  .card-header {
    background-color: #EAEAEA;
    padding: 15px 20px;
  }
  
  .card-title {
    font-weight: 600;
    color: #5D2A00;
  }
 
  .microchip-section {
    background-color: #FCFCFC;
    border-top: 1px solid #EEE;
    border-bottom: 1px solid #EEE;
    padding: 15px 0;
  }
  
  .microchip-header {
    text-align: center;
    font-weight: 600;
    margin-bottom: 15px;
  }
  
  
  #description {
    height: 150px;
    resize: vertical;
    border-bottom: 2px double #EAEAEA;
  }
  
 
  .btn-primary {
    background-color: #8B4513;
    border-color: #8B4513;
    padding: 10px 20px;
    font-weight: 500;
  }
  
  .btn-primary:hover {
    background-color: #5D2A00;
    border-color: #5D2A00;
  }
  
  .btn-outline-secondary {
    background-color: #F5F5F5;
    color: #333;
    border-color: #DDD;
    padding: 10px 20px;
  }
  
  .btn-outline-secondary:hover {
    background-color: #EAEAEA;
    color: #222;
  }
  
  /* Breadcrumb */
  .breadcrumb-item a {
    color: #8B4513;
    text-decoration: none;
  }
  
  .breadcrumb-item a:hover {
    color: #5D2A00;
    text-decoration: underline;
  }
  
  .breadcrumb-item+.breadcrumb-item::before {
    content: "â–¸";
  }
  
  
  .date-field-container {
    position: relative;
  }
  
  .date-field-icon {
    position: absolute;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
    color: #8B4513;
    pointer-events: none;
  }
  
 
  .required-field-indicator {
    border-bottom: 2px solid #FF6B6B;
  }
</style>
{% endblock %}

{% block main_content %}
<div class="row mb-4">
    <div class="col-md-8">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{{ url_for('dashboard.index') }}">Dashboard</a></li>
                <li class="breadcrumb-item active">Add New Dog</li>
            </ol>
        </nav>
        <h1 class="mb-0">Add New Dog</h1>
        <p class="text-muted">Enter information for a new dog</p>
    </div>
    <div class="col-md-4 text-md-end">
        <a href="{{ url_for('dashboard.index') }}" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left me-1"></i> Back to Dashboard
        </a>
    </div>
</div>

<div class="row">
    <div class="col-lg-8 mx-auto">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">Dog Information</h5>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('dogs.add') }}" class="needs-validation" novalidate>
                    <div class="mb-3">
                        <label for="name" class="form-label">Name <span class="required-field">*</span></label>
                        <input type="text" class="form-control" id="name" name="name" required placeholder="Dog's name">
                        <div class="invalid-feedback">
                            Please provide a name for the dog.
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="breed" class="form-label">Breed <span class="required-field">*</span></label>
                        <select class="form-select" id="breed" name="breed" required multiple>
                            {% for breed in breeds %}
                            <option value="{{ breed.breedID }}">{{ breed.name }}</option>
                            {% endfor %}
                        </select>
                        <div class="form-text text-muted">Select multiple breeds or choose "Mixed"/"Unknown"</div>
                        <div class="invalid-feedback">
                            Please select at least one breed.
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="sex" class="form-label">Sex <span class="required-field">*</span></label>
                                <select class="form-select" id="sex" name="sex" required>
                                    <option value="" selected disabled>Male/Female/Unknown</option>
                                    <option value="Male">Male</option>
                                    <option value="Female">Female</option>
                                    <option value="Unknown">Unknown</option>
                                </select>
                                <div class="invalid-feedback">
                                    Please select the dog's sex.
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="alteration_status" class="form-label">Alteration Status <span class="required-field">*</span></label>
                                <select class="form-select" id="alteration_status" name="alteration_status" required>
                                    <option value="" selected disabled>Select status</option>
                                    <option value="true">Altered</option>
                                    <option value="false">Not Altered</option>
                                </select>
                                <div class="invalid-feedback">
                                    Please select the alteration status.
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="age_at_time_of_surrender" class="form-label">Age at Surrender (months) <span class="required-field">*</span></label>
                                <input type="number" class="form-control" id="age_at_time_of_surrender" name="age_at_time_of_surrender" min="0" required placeholder="Enter age in months">
                                <div class="invalid-feedback">
                                    Please provide a valid age.
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="surrender_date" class="form-label">Surrender Date <span class="required-field">*</span></label>
                                <div class="date-field-container">
                                    <input type="date" class="form-control" id="surrender_date" name="surrender_date" required>
                                    <div class="date-field-icon">
                                        <i class="fas fa-calendar-alt"></i>
                                    </div>
                                </div>
                                <div class="form-text text-muted">Format: YYYY/MM/DD</div>
                                <div class="invalid-feedback">
                                    Please provide the surrender date.
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="adoptability_status" class="form-label">Adoptability Status <span class="required-field">*</span></label>
                                <select class="form-select" id="adoptability_status" name="adoptability_status" required>
                                    <option value="" selected disabled>Select status</option>
                                    <option value="Available">Available</option>
                                    <option value="Not Available">Not Available</option>
                                </select>
                                <div class="invalid-feedback">
                                    Please select the adoptability status.
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="animal_control" class="form-label">Surrendered by Animal Control <span class="required-field">*</span></label>
                                <select class="form-select" id="animal_control" name="animal_control" required>
                                    <option value="" selected disabled>Select option</option>
                                    <option value="true">Yes</option>
                                    <option value="false">No</option>
                                </select>
                                <div class="invalid-feedback">
                                    Please specify if the dog was surrendered by animal control.
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="surrender_phone_number" class="form-label">Surrenderer's Phone Number</label>
                        <input type="tel" class="form-control" id="surrender_phone_number" name="surrender_phone_number" placeholder="(xxx) xxx-xxxx">
                        <div class="form-text text-muted" id="phone_help_text">Optional for personal surrenders, required for animal control surrenders.</div>
                    </div>

                    {% if user_is_adult %}
                    <div class="card mb-4 microchip-section">
                        <div class="card-header bg-light">
                            <h6 class="microchip-header mb-0">Microchip Information (Optional)</h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="microchip_ID" class="form-label">Microchip ID</label>
                                        <input type="text" class="form-control" id="microchip_ID" name="microchip_ID" placeholder="Enter microchip ID">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="microchip_vendor_ID" class="form-label">Microchip Vendor</label>
                                        <select class="form-select" id="microchip_vendor_ID" name="microchip_vendor_ID">
                                            <option value="">Select vendor (if applicable)</option>
                                            {% for vendor in microchip_vendors %}
                                            <option value="{{ vendor.id }}">{{ vendor.name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    <div class="mb-4">
                        <label for="description" class="form-label">Description</label>
                        <textarea class="form-control" id="description" name="description" rows="4" placeholder="Enter any additional information about the dog, such as health concerns or other relevant details."></textarea>
                    </div>

                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <a href="{{ url_for('dashboard.index') }}" class="btn btn-outline-secondary">
                            Cancel
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-check me-1"></i> Submit
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
       
        const requiredInputs = document.querySelectorAll('input[required], select[required]');
        requiredInputs.forEach(input => {
            input.addEventListener('focus', function() {
                this.classList.add('required-field-indicator');
            });
            
            input.addEventListener('blur', function() {
                this.classList.remove('required-field-indicator');
            });
        });

        
        const breedSelect = document.getElementById('breed');
        
        breedSelect.addEventListener('change', function() {
            const selectedOptions = Array.from(this.selectedOptions).map(option => option.text);
            const unknownMixedSelected = selectedOptions.some(option => option === 'Unknown' || option === 'Mixed');
            
            if (unknownMixedSelected && selectedOptions.length > 1) {
                Array.from(this.options).forEach(option => {
                    if (option.text !== 'Unknown' && option.text !== 'Mixed') {
                        option.selected = false;
                    }
                });
            }
        });
        
    
        const animalControlSelect = document.getElementById('animal_control');
        const phoneInput = document.getElementById('surrender_phone_number');
        const phoneHelpText = document.getElementById('phone_help_text');
        
        animalControlSelect.addEventListener('change', function() {
            if (this.value === 'true') {
                phoneInput.setAttribute('required', 'required');
                phoneInput.classList.add('required-field-indicator');
                phoneHelpText.innerHTML = '<span class="required-field">*</span> Required for animal control surrenders.';
            } else {
                phoneInput.removeAttribute('required');
                phoneInput.classList.remove('required-field-indicator');
                phoneHelpText.textContent = 'Optional for personal surrenders, required for animal control surrenders.';
            }
        });
        
    
        const form = document.querySelector('form');
        const submitButton = form.querySelector('button[type="submit"]');
        
        form.addEventListener('submit', function(event) {
            if (!form.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();
                
                const invalidFields = form.querySelectorAll(':invalid');
                invalidFields.forEach(field => {
                    field.classList.add('required-field-indicator');
                });
            } else {
                submitButton.disabled = true;
                submitButton.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Submitting...';
            }
            
            form.classList.add('was-validated');
        });
    });
</script>
{% endblock %}